<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USCG Auxiliary BQ Training Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .header h1 {
            color: #1e3c72;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        .header-left {
            flex: 1;
            text-align: left;
        }
        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .user-name {
            color: #1e3c72;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .logout-btn, .help-btn {
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .logout-btn {
            background: #dc3545;
        }
        .logout-btn:hover {
            background: #c82333;
        }
        .help-btn {
            background: #ffc107;
            color: #333;
        }
        .help-btn:hover {
            background: #ffb300;
        }
        .login-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .login-type-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .login-type-btn {
            flex: 1;
            padding: 12px;
            background: #ddd;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .login-type-btn.active {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border-color: #dc3545;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #1e3c72;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            font-family: Arial, sans-serif;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .form-group button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
        }
        .form-group button:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
        }
        .reset-password-link {
            text-align: center;
            margin-top: 15px;
        }
        .reset-password-link a {
            color: #dc3545;
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .reset-password-link a:hover {
            text-decoration: underline;
        }
        #loginView, #traineeView, #leaderView, #resetView, #feedbackView {
            display: none;
        }
        #loginView.active, #traineeView.active, #leaderView.active, #resetView.active, #feedbackView.active {
            display: block;
        }
        .checklist-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #6c757d;
        }
        .checklist-item.completed {
            background: #d4edda;
            border-left-color: #28a745;
        }
        .checklist-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.2);
            cursor: pointer;
        }
        .checklist-item label {
            flex: 1;
            cursor: pointer;
            font-weight: 500;
        }
        .checklist-description {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #ddd;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.3s ease;
        }
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .admin-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .admin-card:hover {
            transform: translateY(-5px);
        }
        .admin-card.green {
            border-left: 5px solid #28a745;
        }
        .admin-card.yellow {
            border-left: 5px solid #ffc107;
        }
        .admin-card.red {
            border-left: 5px solid #dc3545;
        }
        .admin-card h3 {
            margin-bottom: 10px;
            color: #1e3c72;
        }
        .admin-card .percent {
            font-size: 2.5rem;
            font-weight: bold;
            color: #dc3545;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
        .modal.show {
            display: block;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        .close-modal-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal-btn:hover {
            color: black;
        }
        .section-breakdown {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .section-breakdown h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        .stat-card h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #dc3545;
        }
        .progress-board-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .progress-board-table thead {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }
        .progress-board-table th, .progress-board-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .progress-board-table th {
            font-weight: bold;
        }
        .progress-board-table tbody tr:nth-child(odd) {
            background: #f8f9fa;
        }
        .progress-board-table tbody tr:hover {
            background: #e7f3ff;
        }
        .rank-medal {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0;
        }
        .back-btn:hover {
            background: #5a6268;
        }
        .feedback-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .feedback-question {
            margin-bottom: 20px;
        }
        .feedback-question label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #1e3c72;
        }
        .feedback-question textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            font-family: Arial, sans-serif;
            resize: vertical;
            min-height: 80px;
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            margin: 0;
        }
        .radio-group input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loginView" class="active">
            <div class="header">
                <h1>üá∫üá∏ USCG Auxiliary BQ Training Tracker</h1>
                <p>Track your path to Basically Qualified status</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label>Login Type:</label>
                    <div class="login-type-buttons">
                        <button class="login-type-btn active" onclick="setLoginType('trainee')">Trainee</button>
                        <button class="login-type-btn" onclick="setLoginType('leader')">Leader</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="memberId">Member ID:</label>
                    <input type="text" id="memberId" placeholder="Enter your Member ID" onload="loadUsername()">
                </div>
                <div class="form-group" id="credentialGroup">
                    <label for="credential" id="credentialLabel">PIN (6 digits):</label>
                    <input type="password" id="credential" placeholder="Enter 6-digit PIN">
                </div>
                <div class="form-group">
                    <button onclick="login()">Login</button>
                </div>
                <div class="reset-password-link">
                    <a onclick="showResetView()">Forgot your password? Reset here</a>
                </div>
            </div>
        </div>

        <div id="resetView">
            <div class="header">
                <h1>üîê Reset Password</h1>
                <button class="back-btn" onclick="showLoginView()">Back to Login</button>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="resetMemberId">Member ID:</label>
                    <input type="text" id="resetMemberId" placeholder="Enter your Member ID">
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password (6+ characters):</label>
                    <input type="password" id="newPassword" placeholder="Enter new password">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password:</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm password">
                </div>
                <div class="form-group">
                    <button onclick="resetPassword()">Reset Password</button>
                </div>
            </div>
        </div>

        <div id="traineeView">
            <div class="header">
                <div class="header-controls">
                    <div class="header-left">
                        <h1>Your BQ Progress</h1>
                        <p class="user-name" id="traineeUserName"></p>
                    </div>
                    <div class="header-right">
                        <button class="help-btn" onclick="openHelpModal()">Need Help?</button>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
            <div style="background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
                </div>
                <div id="checklistContainer" style="margin-top: 30px;"></div>
                <h3 style="margin-top: 40px; color: #1e3c72;">üìä Your Progress Board</h3>
                <table class="progress-board-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Your Position</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody id="traineeLeaderboard"></tbody>
                </table>
            </div>
        </div>

        <div id="leaderView">
            <div class="header">
                <div class="header-controls">
                    <div class="header-left">
                        <h1>Leadership Dashboard</h1>
                        <p class="user-name" id="leaderUserName"></p>
                    </div>
                    <div class="header-right">
                        <button class="help-btn" onclick="openLeaderHelpModal()">Need Help?</button>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
            <div class="stat-cards">
                <div class="stat-card">
                    <h3>On Track</h3>
                    <div class="stat-number" id="onTrackCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>At Risk</h3>
                    <div class="stat-number" id="atRiskCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Needs Attention</h3>
                    <div class="stat-number" id="needsAttentionCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>Group Average</h3>
                    <div class="stat-number" id="groupAverage">0%</div>
                </div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">üë• Trainees</h2>
                <div class="admin-grid" id="adminGrid"></div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">üèÜ Progress Board</h2>
                <table class="progress-board-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Trainee</th>
                            <th>Member ID</th>
                            <th>Progress</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="leaderLeaderboard"></tbody>
                </table>
            </div>
        </div>

        <div id="feedbackView">
            <div class="header">
                <h1>üéâ Congratulations!</h1>
                <p>You've completed your BQ requirements!</p>
            </div>
            <div class="feedback-form">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">Quick Feedback</h2>
                <div class="feedback-question">
                    <label>Did this tracker help you track your progress?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="helpful" value="yes"> Yes, very helpful</label>
                        <label><input type="radio" name="helpful" value="somewhat"> Somewhat helpful</label>
                        <label><input type="radio" name="helpful" value="no"> Not helpful</label>
                    </div>
                </div>
                <div class="feedback-question">
                    <label>Would you use this tracker again for other training?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="useAgain" value="yes"> Yes</label>
                        <label><input type="radio" name="useAgain" value="maybe"> Maybe</label>
                        <label><input type="radio" name="useAgain" value="no"> No</label>
                    </div>
                </div>
                <div class="feedback-question">
                    <label for="comments">Any comments or suggestions?</label>
                    <textarea id="comments" placeholder="Share your thoughts..."></textarea>
                </div>
                <div class="form-group">
                    <button onclick="submitFeedback()">Submit Feedback</button>
                </div>
                <div class="form-group">
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <div id="detailModal" class="modal">
            <div class="modal-content">
                <span class="close-modal-btn" onclick="closeDetailModal()">&times;</span>
                <div id="detailContent"></div>
            </div>
        </div>

        <div id="helpModal" class="modal">
            <div class="modal-content">
                <span class="close-modal-btn" onclick="closeHelpModal()">&times;</span>
                <h2 style="color: #1e3c72; margin-bottom: 20px;">üìû Need Help?</h2>
                <p style="margin-bottom: 20px; color: #666;">Let us know what you need assistance with and we'll get back to you as soon as possible.</p>
                <div class="form-group">
                    <label for="helpTopic">What do you need help with?</label>
                    <select id="helpTopic">
                        <option value="">-- Select a topic --</option>
                        <option value="training">Training course issue</option>
                        <option value="uniform">Uniform shopping/sizing</option>
                        <option value="records">AUXDATA II navigation</option>
                        <option value="checklist">Understanding checklist items</option>
                        <option value="deadline">Deadline question</option>
                        <option value="certificate">Certificate upload issue</option>
                        <option value="other">Other - I'll explain below</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="helpDetails">Please describe your issue:</label>
                    <textarea id="helpDetails" placeholder="Tell us what's going on..."></textarea>
                </div>
                <div class="form-group">
                    <button onclick="submitHelpRequest()">Send Help Request</button>
                </div>
            </div>
        </div>

        <div id="leaderHelpModal" class="modal">
            <div class="modal-content">
                <span class="close-modal-btn" onclick="closeLeaderHelpModal()">&times;</span>
                <h2 style="color: #1e3c72; margin-bottom: 20px;">üìû Leader Help Request</h2>
                <p style="margin-bottom: 20px; color: #666;">Need assistance managing trainees or using the tracker?</p>
                <div class="form-group">
                    <label for="leaderHelpTopic">What do you need help with?</label>
                    <select id="leaderHelpTopic">
                        <option value="">-- Select a topic --</option>
                        <option value="tracker">How to use the tracker</option>
                        <option value="trainee-support">Supporting a trainee</option>
                        <option value="deadline">Training deadline/requirements</option>
                        <option value="data">Data interpretation/reports</option>
                        <option value="technical">Technical issue with tracker</option>
                        <option value="other">Other - I'll explain below</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="leaderHelpDetails">Please describe your issue:</label>
                    <textarea id="leaderHelpDetails" placeholder="Tell us what's going on..."></textarea>
                </div>
                <div class="form-group">
                    <button onclick="submitLeaderHelpRequest()">Send Help Request</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLoginType = 'trainee';

        const TRAINEES = [
            { memberId: '5009810', name: 'Jessica Arciero' },
            { memberId: '1249011', name: 'Stephen Belcher' },
            { memberId: '5006078', name: 'Joseph Cerletti' },
            { memberId: '5005376', name: 'Hanley Chan' },
            { memberId: '5009795', name: 'Cody Jokela' },
            { memberId: '5009811', name: 'Sheila Jessup' },
            { memberId: '1215416', name: 'Gregory Maroulas' },
            { memberId: '1209105', name: 'Robert Tucknott' },
            { memberId: '5009561', name: 'Jake Yoshino' },
            { memberId: '5010123', name: 'Daniel Gamache' },
            { memberId: '5010122', name: 'Brian Tang' },
            { memberId: '5009876', name: 'Chris Chen' },
            { memberId: '5009877', name: 'Jarvis Delaine' },
            { memberId: '5009878', name: 'Patrick Maguire' },
            { memberId: '5009879', name: 'Nauzer Gotla' }
        ];

        const LEADERS = [
            { memberId: '5009623', name: 'Yohannes Tilahun' },
            { memberId: '3010789', name: 'Adam Kovalevsky' },
            { memberId: '3007136', name: 'Adrienne Kuehneman' }
        ];

        const BQ_CHECKLIST = {
            setup: ['Secure welcome letter', 'Save Member ID and Flotilla Number', 'Set up login credentials', 'Confirm account activation', 'Test Moodle access', 'Locate training portal', 'Get enrollment keys', 'System navigation notes'],
            training: ['California Boater Card', 'Email boater certificate to Adam (Flotilla Leader)', 'AUXCT CORE Certification', 'Security Fundamentals', 'Privacy Awareness', 'Sexual Harassment Prevention', 'Suicide Prevention', 'Sexual Assault Prevention', 'Civil Rights Awareness', 'Ethics Training', 'FEMA ICS-100', 'FEMA IS-700', 'Email FEMA certificates to Adam (Flotilla Leader)', 'BQC II Module 1', 'BQC II Module 2', 'BQC II Module 3', 'BQC II Module 4', 'BQC II Module 6', 'BQC II Module 7', 'Bloodborne Pathogens', 'Risk Management', 'Download and save all certificates', 'Training tips noted'],
            records: ['AUXDATA II access', 'AD2 training', 'Member Records', 'Activity Log', 'My Competencies', 'My Tasks', 'My Awards', 'Verify training records', 'Understand Certificate Timeline (90 days)', 'Understand Follow-up Timeline', 'FEMA certificates uploaded', 'Bloodborne Pathogens listed', 'Member information verified', 'Submit missing certificates if needed'],
            uniforms: ['Review Uniform Manual', 'Research uniform options', 'Check for donated uniforms', 'ODU Ball Cap', 'Name Tape', 'USCG AUXILIARY Tape', 'ODU Blouse', 'ODU Trousers', 'Blue T-Shirt', 'Riggers Belt', 'ODU Collar Device', 'Ball Cap Device', 'Tactical Boots', 'Black Military Socks', 'Trouser Blousers', 'Dress Shirt', 'Dress Trousers', 'Garrison Cap OR Combination Cap', 'Auxiliary Belt', 'Name Tag', 'Shoulder Boards', 'Garrison Cap Device', 'Dress Shoes', 'Thin Black Socks', 'Visit CGX Shop', 'Acquire uniform', 'Schedule inspection', 'Pass inspection'],
            final: ['Verify training completed', 'Confirm boater certification', 'Confirm uniform inspection', 'Check BQ Status Form', 'Mentor review', 'Request BQ status', 'Apply for ID card', 'BQ status confirmed', 'ID card received']
        };

        const LEADER_PASSWORDS = {
            '5009623': '116511'
        };

        const HELP_REQUESTS = [];

        function setLoginType(type) {
            currentLoginType = type;
            const buttons = document.querySelectorAll('.login-type-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const label = document.getElementById('credentialLabel');
            const input = document.getElementById('credential');
            if (type === 'trainee') {
                label.textContent = 'PIN (6 digits):';
                input.placeholder = 'Enter 6-digit PIN';
            } else {
                label.textContent = 'Password:';
                input.placeholder = 'Enter password (or leave blank to set one)';
            }
        }

        function login() {
            const memberId = document.getElementById('memberId').value;
            let credential = document.getElementById('credential').value;

            if (!memberId) {
                alert('Please enter your Member ID');
                return;
            }

            localStorage.setItem('lastUsername', memberId);

            if (currentLoginType === 'trainee') {
                if (!credential) {
                    alert('Please enter your PIN');
                    return;
                }
                if (credential.length !== 6 || isNaN(credential)) {
                    alert('PIN must be 6 digits');
                    return;
                }
                localStorage.setItem('currentUser', JSON.stringify({ memberId, credential, type: 'trainee' }));
                showTraineeView();
            } else {
                if (!credential) {
                    const newPassword = prompt('No password set. Enter a new password (6+ characters):');
                    if (!newPassword) {
                        alert('Password is required');
                        return;
                    }
                    if (newPassword.length < 6) {
                        alert('Password must be at least 6 characters');
                        return;
                    }
                    LEADER_PASSWORDS[memberId] = newPassword;
                    localStorage.setItem('currentUser', JSON.stringify({ memberId, credential: newPassword, type: 'leader' }));
                    alert('Password set successfully!');
                    showLeaderView();
                } else {
                    if (!LEADER_PASSWORDS[memberId] || LEADER_PASSWORDS[memberId] !== credential) {
                        alert('Invalid Member ID or Password');
                        return;
                    }
                    localStorage.setItem('currentUser', JSON.stringify({ memberId, credential, type: 'leader' }));
                    showLeaderView();
                }
            }
        }

        function showLoginView() {
            document.getElementById('loginView').classList.add('active');
            document.getElementById('resetView').classList.remove('active');
            document.getElementById('traineeView').classList.remove('active');
            document.getElementById('leaderView').classList.remove('active');
            document.getElementById('feedbackView').classList.remove('active');
        }

        function showResetView() {
            document.getElementById('loginView').classList.remove('active');
            document.getElementById('resetView').classList.add('active');
        }

        function resetPassword() {
            const memberId = document.getElementById('resetMemberId').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!memberId || !newPassword || !confirmPassword) {
                alert('Please fill in all fields');
                return;
            }

            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            LEADER_PASSWORDS[memberId] = newPassword;
            alert('Password reset successful! You can now login with your new password.');
            showLoginView();
            document.getElementById('resetMemberId').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function logout() {
            localStorage.removeItem('currentUser');
            showLoginView();
            document.getElementById('credential').value = '';
            loadUsername();
        }

        function loadUsername() {
            const lastUsername = localStorage.getItem('lastUsername');
            if (lastUsername) {
                document.getElementById('memberId').value = lastUsername;
            }
        }

        function showTraineeView() {
            document.getElementById('loginView').classList.remove('active');
            document.getElementById('resetView').classList.remove('active');
            document.getElementById('leaderView').classList.remove('active');
            document.getElementById('feedbackView').classList.remove('active');
            document.getElementById('traineeView').classList.add('active');
            renderTraineeView();
        }

        function showLeaderView() {
            document.getElementById('loginView').classList.remove('active');
            document.getElementById('resetView').classList.remove('active');
            document.getElementById('traineeView').classList.remove('active');
            document.getElementById('feedbackView').classList.remove('active');
            document.getElementById('leaderView').classList.add('active');
            renderLeaderView();
        }

        function renderTraineeView() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const trainee = TRAINEES.find(t => t.memberId === user.memberId);
            document.getElementById('traineeUserName').textContent = trainee ? trainee.name + ' (' + trainee.memberId + ')' : 'User (' + user.memberId + ')';

            let html = '';
            for (const [section, items] of Object.entries(BQ_CHECKLIST)) {
                html += `<h3 style="color: #1e3c72; margin-top: 30px; margin-bottom: 15px;">üìã ${section.toUpperCase()}</h3>`;
                items.forEach((item, idx) => {
                    const itemId = `${user.memberId}-${section}-${idx}`;
                    const isChecked = localStorage.getItem(itemId) === 'true';
                    let description = '';
                    if (section === 'records' && item.includes('Competencies')) {
                        description = '<div class="checklist-description">Log into AUXDATA II and learn to navigate this section. <a href="https://wow.uscgaux.info/content.php?unit=H-DEPT&category=auxiliary-uniforms" target="_blank" style="color: #dc3545;">View training guide</a></div>';
                    }
                    html += `
                        <div class="checklist-item ${isChecked ? 'completed' : ''}">
                            <input type="checkbox" id="${itemId}" ${isChecked ? 'checked' : ''} onchange="updateProgress()">
                            <label for="${itemId}">${item}${description}</label>
                        </div>
                    `;
                });
            }
            document.getElementById('checklistContainer').innerHTML = html;
            updateProgress();
        }

        function updateProgress() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            let total = 0, completed = 0;
            for (const [section, items] of Object.entries(BQ_CHECKLIST)) {
                items.forEach((_, idx) => {
                    total++;
                    if (localStorage.getItem(`${user.memberId}-${section}-${idx}`) === 'true') {
                        completed++;
                    }
                });
            }
            const progress = Math.round((completed / total) * 100);
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressFill').textContent = progress + '%';
            localStorage.setItem(`${user.memberId}-progress`, progress);

            if (progress === 100) {
                showFeedbackView();
            } else {
                updateLeaderboards();
            }
        }

        function updateLeaderboards() {
            const leaderboardData = TRAINEES.map(trainee => {
                const progress = parseInt(localStorage.getItem(`${trainee.memberId}-progress`) || '0');
                return { ...trainee, progress };
            }).sort((a, b) => b.progress - a.progress);

            const user = JSON.parse(localStorage.getItem('currentUser'));
            const userRank = leaderboardData.findIndex(t => t.memberId === user.memberId) + 1;

            let traineeHtml = '';
            leaderboardData.forEach((t, idx) => {
                if (t.memberId === user.memberId) {
                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                    const medal = idx < 3 ? medals[idx] : '';
                    traineeHtml += `
                        <tr style="background: #fff3cd; font-weight: bold;">
                            <td><span class="rank-medal">${medal}</span>${idx + 1}</td>
                            <td>You are here</td>
                            <td style="color: #1e3c72;">${t.progress}%</td>
                        </tr>
                    `;
                }
            });
            document.getElementById('traineeLeaderboard').innerHTML = traineeHtml;

            let leaderHtml = '';
            leaderboardData.forEach((t, idx) => {
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                const medal = idx < 3 ? medals[idx] : '';
                const statusClass = t.progress >= 70 ? '#28a745' : t.progress >= 30 ? '#ffc107' : '#dc3545';
                const statusText = t.progress >= 70 ? '‚úì On Track' : t.progress >= 30 ? '‚ü≥ At Risk' : '‚ö† Needs Help';
                leaderHtml += `
                    <tr>
                        <td><span class="rank-medal">${medal}</span>${idx + 1}</td>
                        <td>${t.name}</td>
                        <td>${t.memberId}</td>
                        <td style="color: #1e3c72; font-weight: bold;">${t.progress}%</td>
                        <td style="text-align: center; background: ${statusClass}; color: white; border-radius: 5px;">${statusText}</td>
                    </tr>
                `;
            });
            document.getElementById('leaderLeaderboard').innerHTML = leaderHtml;
        }

        function renderLeaderView() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const leader = LEADERS.find(l => l.memberId === user.memberId);
            document.getElementById('leaderUserName').textContent = leader ? leader.name + ' (' + leader.memberId + ')' : 'Leader (' + user.memberId + ')';

            const stats = { onTrack: 0, atRisk: 0, needsAttention: 0, total: 0, avgProgress: 0 };
            const leaderboardData = TRAINEES.map(trainee => {
                const progress = parseInt(localStorage.getItem(`${trainee.memberId}-progress`) || '0');
                if (progress >= 70) stats.onTrack++;
                else if (progress >= 30) stats.atRisk++;
                else stats.needsAttention++;
                stats.total++;
                stats.avgProgress += progress;
                return { ...trainee, progress };
            }).sort((a, b) => b.progress - a.progress);

            stats.avgProgress = Math.round(stats.avgProgress / stats.total);

            document.getElementById('onTrackCount').textContent = stats.onTrack;
            document.getElementById('atRiskCount').textContent = stats.atRisk;
            document.getElementById('needsAttentionCount').textContent = stats.needsAttention;
            document.getElementById('groupAverage').textContent = stats.avgProgress + '%';

            let gridHtml = '';
            TRAINEES.forEach(trainee => {
                const progress = parseInt(localStorage.getItem(`${trainee.memberId}-progress`) || '0');
                const statusClass = progress >= 70 ? 'green' : progress >= 30 ? 'yellow' : 'red';
                gridHtml += `
                    <div class="admin-card ${statusClass}" onclick="viewTraineeDetails('${trainee.memberId}')">
                        <h3>${trainee.name}</h3>
                        <p>${trainee.memberId}</p>
                        <div class="percent">${progress}%</div>
                    </div>
                `;
            });
            document.getElementById('adminGrid').innerHTML = gridHtml;

            let leaderboardHtml = '';
            leaderboardData.forEach((t, idx) => {
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                const medal = idx < 3 ? medals[idx] : '';
                const statusClass = t.progress >= 70 ? '#28a745' : t.progress >= 30 ? '#ffc107' : '#dc3545';
                const statusText = t.progress >= 70 ? '‚úì On Track' : t.progress >= 30 ? '‚ü≥ At Risk' : '‚ö† Needs Help';
                leaderboardHtml += `
                    <tr>
                        <td><span class="rank-medal">${medal}</span>${idx + 1}</td>
                        <td>${t.name}</td>
                        <td>${t.memberId}</td>
                        <td style="color: #1e3c72; font-weight: bold;">${t.progress}%</td>
                        <td style="text-align: center; background: ${statusClass}; color: white; border-radius: 5px;">${statusText}</td>
                    </tr>
                `;
            });
            document.getElementById('leaderLeaderboard').innerHTML = leaderboardHtml;
        }

        function viewTraineeDetails(memberId) {
            const trainee = TRAINEES.find(t => t.memberId === memberId);
            let html = `<h2>${trainee.name} (${memberId})</h2>`;
            html += `<div style="text-align: center; margin: 20px 0;"><div style="font-size: 3rem; font-weight: bold; color: #dc3545;">${parseInt(localStorage.getItem(`${memberId}-progress`) || '0')}%</div></div>`;

            for (const [section, items] of Object.entries(BQ_CHECKLIST)) {
                let completed = 0;
                items.forEach((_, idx) => {
                    if (localStorage.getItem(`${memberId}-${section}-${idx}`) === 'true') completed++;
                });
                html += `<div class="section-breakdown"><h4>${section.toUpperCase()} (${completed}/${items.length})</h4>`;
                items.forEach((item, idx) => {
                    const isChecked = localStorage.getItem(`${memberId}-${section}-${idx}`) === 'true';
                    html += `<div style="padding: 5px; ${isChecked ? 'color: #28a745;' : ''}">${isChecked ? '‚úÖ' : '‚≠ï'} ${item}</div>`;
                });
                html += `</div>`;
            }

            document.getElementById('detailContent').innerHTML = html;
            document.getElementById('detailModal').classList.add('show');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        function openHelpModal() {
            document.getElementById('helpModal').classList.add('show');
            document.getElementById('helpTopic').value = '';
            document.getElementById('helpDetails').value = '';
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('show');
        }

        function openLeaderHelpModal() {
            document.getElementById('leaderHelpModal').classList.add('show');
            document.getElementById('leaderHelpTopic').value = '';
            document.getElementById('leaderHelpDetails').value = '';
        }

        function closeLeaderHelpModal() {
            document.getElementById('leaderHelpModal').classList.remove('show');
        }

        function submitHelpRequest() {
            const use
